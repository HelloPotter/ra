<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RA Practice Tool V1.0</title>

<script src="https://code.responsivevoice.org/responsivevoice.js"></script>

<style>
:root{
  --bg:#f4f6fb;
  --panel:#ffffff;
  --accent:#1f6feb;
  --accent-dark:#155fcc;
  --highlight:#d32f2f;
  --muted:#6b7280;
}
body{margin:0;background:var(--bg);font-family:Inter,"Segoe UI",Arial,sans-serif;color:#0b1220;}
.wrap{max-width:900px;margin:20px auto;padding:16px;}
header{text-align:center;margin-bottom:18px;}
h1{margin:0;font-size:26px;}
.sub{color:var(--muted);font-size:15px;margin-top:4px;}

/* 顶部控件模块：单行布局 */
.controls{
  background:var(--panel);
  border-radius:10px;
  padding:16px 20px;
  box-shadow:0 4px 14px rgba(0,0,0,0.05);
  display:flex;
  align-items:flex-end;
  gap:20px;                 /* 控件水平间距 */
  margin-bottom:16px;       /* 与下方模块垂直间距 */
}
.ctrl-item{
  display:flex;
  flex-direction:column;
  flex-shrink:0;
}
.ctrl-item.flex{flex:1;}    /* Question自动拉伸 */
.ctrl-item span{
  font-size:14px;
  color:var(--muted);
  margin-bottom:6px;
}
.ctrl-item select,
.ctrl-item input[type=number],
.ctrl-item button{
  height:34px;
  padding:5px 8px;
  border:1px solid #d0d4dc;
  border-radius:6px;
  font-size:14px;
  background:#fff;
  box-shadow:none;
  appearance:none;
}
.ctrl-item input[type=number]{
  padding: 0 8px;
}
.ctrl-item button{
  cursor:pointer;
  transition:background .12s ease;
}
.ctrl-item button:hover{background:#f0f3f7;}

/* 题库文本 */
.text-panel{
  padding:22px;
  font-size:30px;
  line-height:2.1;
  border-radius:10px;
  min-height:260px;
  background:var(--panel);
  box-shadow:0 4px 14px rgba(0,0,0,0.05);
}
.word{display:inline-block;white-space:pre;transition:color .08s linear;}
.word.default{color:#111;}
.word.colored{color:var(--highlight);}

/* 下方按钮 */
.buttons{
  display:flex;
  justify-content:center;
  gap:20px;
  margin-top:22px;
}
button.primary,button.secondary{
  width:140px;
  height:44px;
  border-radius:6px;
  font-size:16px;
  cursor:pointer;
  border:none;
  transition:background .12s ease;
}
button.primary{background:var(--accent);color:#fff;}
button.primary:hover{background:var(--accent-dark);}
button.secondary{background:#fff;border:1px solid #d0d4dc;color:#0b1220;}
button.secondary:hover{background:#f0f3f7;}

.status{font-size:14px;color:var(--muted);margin-top:12px;text-align:center;}
footer{text-align:center;margin-top:36px;color:var(--muted);font-size:12px;}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>RA Practice Tool V1.0</h1>
    <div class="sub">Practice Read Aloud Anywhere — Designed for PTE Core</div>
  </header>

  <!-- 顶部控件区域：单行 -->
  <div class="controls">
    <label class="ctrl-item flex">
      <span>Question</span>
      <select id="selectQ"></select>
    </label>
    <label class="ctrl-item">
      <span>Voice</span>
      <select id="voiceSelect">
        <option value="US English Male">US English Male</option>
        <option value="US English Female">US English Female</option>
        <option value="UK English Male">UK English Male</option>
        <option value="UK English Female">UK English Female</option>
      </select>
    </label>
    <label class="ctrl-item">
      <span>Repeat</span>
      <input type="number" id="repeatInput" value="1" min="1" max="10">
    </label>
    <label class="ctrl-item">
      <span>Mode</span>
      <button id="modeBtn">Custom Mode</button>
    </label>
    <label class="ctrl-item">
      <span>View</span>
      <button id="fullscreenBtn">Enter Full Screen</button>
    </label>
  </div>

  <div class="text-panel" id="textPanel">
    <div id="paraMeta" style="font-size:15px;margin-bottom:8px;color:#6b7280;">Select a question to start</div>
    <div id="paraContent"></div>
  </div>

  <div class="buttons">
    <button class="secondary" id="prevBtn">◀ Previous</button>
    <button class="primary" id="startBtn">▶ Start</button>
    <button class="secondary" id="nextBtn">Next ▶</button>
  </div>
  <div class="status" id="status">Status: idle</div>

  <footer>RA Read-Aloud Practice — © 2025 Stone Zhao</footer>
</div>

<script>
// ====== 题库示例（可继续补全）======
const passages=[
  { id:4, title:"Yellow", text:
`Yellow is considered as the most optimistic color. Yet surprisingly, people lose their tempers more often in yellow rooms / and babies cry more in them. The reason may be that yellow is the hardest color / for eyes to take in. So it can be overpowering if overused.`},
{ id:10, title:"Alphabet", text:
`The problem begins with the alphabet itself. Building a spelling system for English / using letters that come from Latin — despite the two languages not sharing exactly the same set of sounds — is like building a playroom / using an IKEA office set.`},
{ id:17, title:"Cat's Paws", text:
`In the photo, the wild cat's huge paws are clamped / onto the side of the white safari Jeep / in which Chappell was a passenger. Almost as tall as the Jeep on her hind legs, she appears to be forcing her muzzle / into the back window.`},
{ id:26, title:"Yellow", text:
`Cheerful sunny yellow is an attention getter. While it is considered an optimistic color, people lose their tempers more often in yellow rooms, and babies will cry more. It is the most difficult color for the eye to take in, so it can be overpowering if overused. Yellow enhances concentration, hence its use for legal pads. It also speeds metabolism.`},
{ id:32, title:"War on Women", text:
`While the Republican field is packed with male candidates, so far, some of the sharpest Clinton critics have come from women. Democrats successfully campaigned on an alleged GOP perpetrated "war on women" in 2012, but faltered in 2014 / when they tried the same tactic. With Hillary Clinton as the likely Democratic nominee, the fight for women voters will be a central part / of the 2016 campaign.`},
{ id:51, title:"Classic Adaption", text:
`A recent trend in the entertainment world is to adapt classic works of literature / for either TV or movies. One argument is that this is to everyone's benefit, as it introduces people to works / they might otherwise never have, but is rarely done successfully.`},
{ id:67, title:"Market Research", text:
`Market research is a vital part / of the planning of any business. However experienced you or your staff may be in a particular field, if you are thinking of introducing a service to new area, it is important to find out / what the local population thinks about it first.`},
{ id:110, title:"Learning Method", text:
`There is no single method of learning / that guarantees success. How we learn that depends on many different factors. And what works best for you / will not necessarily be the same as the approach used for the other students / even they study the same course. We are all unique as learners, although some patterns emerge from any groups of students.`},
{ id:117, title:"Rural Population", text:
`Thus, a country might possess a sizeable rural population, but have an economic system / in which the interests of the voters were predominantly related to their incomes, not to their occupations or location; and in such a country the political system would be unlikely / to include an important agrarian party.`},
{ id:136, title:"Productive Capacity", text:
`The core of the problem was the immense disparity / between the country’s productive capacity / and the ability of people to consume. Great innovations in productive techniques during and after the war raised the output of industry / beyond the purchasing capacity of U.S. farmers / and wage earners.`},
{ id:145, title:"Population Growth", text:
`How quickly is the world's population growing? In the United States and other developed countries, the current growth rate is very low. In most developing countries, the human population is growing at a rate / of nearly 3 people per second. Because of this bustling growth rate, the human population is well on its way / to reaching 9 billion within lifetime.`},
{ id:250, title:"Girls v.s. Boys", text:
`Teenage girls are continuing to outperform boys in English / while the gender gap in achievements in math and science has almost disappeared. The figures show that last year 80% of 14-year-old girls reached / at least the expected level 5 in English, compared with 65% of boys. But in math, the girls are just 1% ahead of boys, while in science the difference is 2%.`},
{ id:252, title:"Difficult Conversations", text:
`Surprisingly, despite what appear to be infinite variations, all difficult conversations share a common structure. When you’re caught up in the details and anxiety / of a particularly difficult conversation, this structure is hard to see. But understanding that structure is essential / to improve how you handle your most challenging conversations.`},
{ id:269, title:"Language Appearance", text:
`It seems that language appeared from nowhere / since no other species has anything resembling human language. However, other animals do possess basic systems / for perceiving and producing sounds / that enable them to communicate. These systems may have been in place / before the appearance of language.`},
{ id:288, title:"Fast Food", text:
`Hundreds of millions of American people eat fast food every day / without giving it too much thought, unaware of the subtle and not so subtle ramifications of their purchases. They just grab their tray off the counter, find a table, take a seat, unwrap the paper, and dig in. The whole experience is transitory and soon forgotten.`},
{ id:302, title:"Elephant", text:
`The elephant is the largest living land mammal. During evolution, its skeleton has greatly altered from the usual mammal, designed for two main reasons. One is to cope with the great weight of huge grinding cheek teeth / and elongated tusk, making the skull particularly massive. The other is to support the enormous bulk / of such a huge body.`},
{ id:316, title:"Only Family", text:
`Imagine living all your life / as the only family on your street. Then, one morning, you open the front door / and discover houses all around you. You see neighbors tending their gardens / and children walking to school. Where did all the people come from? What if the answer turned out to be / that they had always been there — you just hadn't seen them.`},
{ id:326, title:"Father (B)", text:
`Every morning, no matter how late he had been up, my father rose at 5:30, went to his study, wrote for a couple of hours, made us all breakfast, read the paper with my mother, and then went back to work for the rest of the morning. Many years passed before I realized / that he did this by choice, for a living, and that he was not unemployed or mentally ill.`},
{ id:338, title:"Parent Teacher Conferences", text:
`Schools host parent teacher conferences four times a year / and it is important for families to attend. This is your chance to meet with teachers / and ask questions about your child's progress. It can be helpful to write down questions ahead of time.`},
{ id:375, title:"Microscopic Invader", text:
`We all know about bacteria, viruses and microscopic protozoa. We can watch the way that these tiny agents move / into our bodies and damage our organs. We have a growing understanding / of how our body mounts defensive strategies / that fight off these invaders, and have built some clever chemical / that can help mount an assault on these bio-villains.`},
{ id:376, title:"Market Research", text:
`There are two main types of market research. Quantitative research involves collecting a lot of information / by using techniques such as questionnaires / and other forms of survey. Qualitative research involves working with smaller samples of consumers, often asking them to discuss products and services / while researchers take notes about what they have to say.`},
{ id:463, title:"Source of Funding", text:
`A study found that the research funded by the soft drinks industry / had different results from research funded by other sources / and went on to suggest that they may have been biased / by the research itself. The whole point of the scientific methods / is to ensure the research results are not influenced / by the source of funding.`},
{ id:472, title:"Selective History", text:
`History is selective. What history books tell us about the past / is not everything that happened, but what historians have selected. They cannot put in everything: choices have to be made. Choices must similarly be made / about which aspects of the past should be formally taught / to the next generation / in the shape of school history lessons.`},
{ id:498, title:"Bond Funds", text:
`Most bond funds have credit risk, which is the risk that companies or other issuers whose bonds are owned by the fund / may fail to pay their debts, including the debt owed to the holder of their bonds. Some funds have little credit risk, such as those that invest in insured bonds / or U.S. Treasury bonds. But be careful: nearly all bond funds have interest rate risk, which means that the market value of the bonds they hold / will go down when interest rates go up.`},
{ id:541, title:"Liverpool", text:
`Located at the heart of two world famous cities, Liverpool and London, Liverpool’s excellence in teaching, learning and research, first-class facilities and outstanding support places the university / in the top 1% of universities worldwide. The University of Liverpool will provide you with an inspiring student experience, in a diverse international community.`},
{ id:577, title:"Conscientiousness", text:
`Conscientiousness is a fundamental personality trait. A conscientious person is good at self-regulation / and impulse control. This trait influences whether you will set and keep long-range goals, deliberate over choices, behave cautiously or impulsively, / and take obligations to others seriously.`},
{ id:579, title:"Blue Whale", text:
`Blue whales are the largest living mammals. Though reports of maximum length and weight vary from one account to another, Antarctic blue whales are known to have reached lengths to 100 feet / and weights of over 150 tons / before stocks were severely depleted by whaling operations. North Atlantic blue whales may be expected to reach lengths / of 80–85 feet.`},
{ id:584, title:"Canada", text:
`With a population of only just over 30 million / living in the world's second largest country, Canada is justly renowned / for vast tracts of wilderness / untroubled by pollution either from industry / or from intensive farming methods. A major conservation issue is the battle / to stop the logging of virgin forest / in northern Ontario / and on the west coast.`},
{ id:590, title:"Children Helping Others", text:
`Children as young as 14 months old / will spontaneously help others for no reward. But a study of 3-to-5-year-olds found that, although they would spontaneously draw pictures, if they were given a reward for drawing pictures, then later they wouldn’t make any drawings / unless a reward was offered.`},
{ id:591, title:"Charlie Parker", text:
`Charlie Parker noticed that the solos were only improvised through the melodies, but that he could also improvise them through the chords, thus creating new variations over the structure of the songs, and also playing more notes and faster.`},
{ id:710, title:"Antarctic", text:
`The world's fifth largest continent: Antarctica is almost entirely covered / by ice 2000 meters thick. The area sustains varied wildlife / including seals, whales, and penguins. The Antarctic treaty signed in 1959 / and enforced since 1961 / provides for international governance of Antarctica.`},
{ id:744, title:"Voyage", text:
`A crew of scientists voyaged by ship / from the southern tip of Chile / into the frigid Antarctic / to search for clues to one of the great unknowns of climate change. They planned to crisscross a remote patch of sea / near the spot where, a year earlier, another crew had injected a tankful of an inert chemical / one mile below the surface.`},
{ id:783, title:"Noise Restrictions", text:
`The noise restrictions are based on measurements on animals in captivity / exposed to noise levels / that induce a temporary threshold shift (TTS) in hearing. The TTS onset threshold is the lowest noise exposure / capable of inducing a small temporary reduction of hearing sensitivity, also known as auditory fatigue, with full recovery shortly after exposure.`},
{ id:787, title:"Depression Symptoms", text:
`Symptoms of depression decrease / with improvements in sense of smell, particularly among patients with dysosmia. New research published in the journal Scientific Reports highlights the intricate relationship / between depression and sense of smell. The study found that participants’ symptoms of depression dropped / as their odor identification improved, particularly among those with an impaired sense of smell.`},
{ id:808, title:"Gut Microbiome", text:
`Research has shown that the gut microbiome is important / for human physiology and health. Disturbances to the composition of the gut microbiome / can be associated with chronic diseases / such as gastrointestinal inflammatory disorders, neurological, cardiovascular and respiratory illnesses. The human body has evolved strategies / to ensure that a symbiotic relationship exists / between the microbes in our gut and our cells.`},
{ id:1012, title:"Making Notes", text:
`The whole purpose of making notes / is to aid your learning. It is important to go back over them / within a day of making them / to make sure they make sense / and make them legible for future revisions. Also, going back over them should highlight the key questions / of areas in which you want to do further reading.`},
{ id:1022, title:"Enough Fluid", text:
`Your body is nearly two-thirds water. And so it is really important / that you consume enough fluid / to stay hydrated and healthy. If you don't get enough fluid you may feel tired, get headaches, and not perform at your best.`},
{ id:1025, title:"Rates of Depression", text:
`At a time when stress levels are soaring, rates of depression are increasing / and the gap between rich and poor is ever widening. We believe that giving can play a positive role / in helping people to feel connected to those around them / and generate a sense of purpose and hope. When we give, we feel valued, useful and happy.`},
{ id:1034, title:"Bill", text:
`The bill calls for the establishment of the National Landslide Hazards Reduction Program / within one year of becoming law. The program serves numerous functions, including to identify and understand landslide hazards and risks, reduce losses from landslides, protect communities at risk of landslides hazards, and improve communication and emergency preparedness.`},
{ id:1228, title:"Community Gardens", text:
`Around the world, city residents build gardens on balconies, rooftops and small strips of land. A March 2023 study published / in the journal Ecology Letters confirms that beyond offering food / and an outlet for cultivating outdoor space, urban gardens provide benefits for the humans, insects, and animals / who inhabit these leafy respites from city life.`},
{ id:1289, title:"Credit Cards", text:
`Credit Cards are a ubiquitous form of payment / that have revolutionized the way we conduct transactions. With a credit card, individuals can make purchases / without having to carry cash / or worry about the availability of funds. Credit cards also offer a range of benefits / such as cashback rewards, travel points, and purchase protection.`}
];

// ====== DOM绑定 ======
const selectQ=document.getElementById('selectQ'),
voiceSelect=document.getElementById('voiceSelect'),
repeatInput=document.getElementById('repeatInput'),
startBtn=document.getElementById('startBtn'),
prevBtn=document.getElementById('prevBtn'),
nextBtn=document.getElementById('nextBtn'),
modeBtn=document.getElementById('modeBtn'),
fullscreenBtn=document.getElementById('fullscreenBtn'),
paraMeta=document.getElementById('paraMeta'),
paraContent=document.getElementById('paraContent'),
statusEl=document.getElementById('status');

let state={idx:0,chunks:[],chunkIndex:0,playing:false,random:false,repeat:1};

function buildChunks(t){
  // 保存专用名词（如 U.S., A.B.C., U.N.E.S.C.O.）
  const properNounMap = new Map();
  let placeholderIndex = 0;
  // 匹配至少两个大写字母加点的连续串，后面跟空格、标点或行尾
  const properNounRegex = /\b(?:[A-Z]\.){2,}(?=[\s,;!?]|$)/g;
  t = t.replace(properNounRegex, match => {
    const placeholder = `__PROPERNOUN${placeholderIndex}__`;
    properNounMap.set(placeholder, match);
    placeholderIndex++;
    return placeholder;
  });

  // 将 / 替换为分隔符
  let s = t.replace(/\s*\/\s*/g,'|');

  // 在逗号、感叹号等处插入停顿
  s = s.replace(/([,!?;:—])/g,'$1|');

  // 在句号后插入停顿，但排除占位符
  s = s.replace(/\./g, (match, offset) => {
    for (const [placeholder, original] of properNounMap) {
      // 如果句号在占位符中，则跳过
      const start = s.indexOf(placeholder);
      const end = start + placeholder.length;
      if (offset >= start && offset < end) return match;
    }
    return '.|';
  });

  // 分割成片段
  let chunks = s.split('|').map(x=>x.trim()).filter(x=>x);

  // 还原专用名词
  chunks = chunks.map(chunk => {
    for (const [placeholder, original] of properNounMap) {
      chunk = chunk.replace(placeholder, original);
    }
    return chunk;
  });

  return chunks;
}

function renderPassage(i){
  state.idx=i;state.chunkIndex=0;
  const p=passages[i];
  paraMeta.textContent=`#${p.id} ${p.title}`;
  const chunks=buildChunks(p.text);
  state.chunks=chunks;
  paraContent.innerHTML='';
  chunks.forEach((chunk,ci)=>{
    chunk.split(/\s+/).forEach(w=>{
      const span=document.createElement('span');
      span.className='word default';
      span.dataset.ci=ci;
      span.textContent=w+' ';
      paraContent.appendChild(span);
    });
  });
}
function highlightClear(){document.querySelectorAll('.word').forEach(w=>w.classList.remove('colored'));}
function updateStatus(t){statusEl.textContent='Status: '+t;}

function playOnceWithPause(chunk){
  return new Promise(resolve=>{
    if(typeof responsiveVoice==='undefined'){resolve();return;}
    let started=performance.now();
    responsiveVoice.speak(chunk, voiceSelect.value,{
      rate:1,
      onstart:()=>updateStatus('Speaking...'),
      onend:()=>{
        const dur=Math.max(300,performance.now()-started);
        updateStatus('Pause...');
        setTimeout(resolve,dur*1.5);
      }
    });
    const words=[...document.querySelectorAll(`.word[data-ci="${state.chunkIndex}"]`)];
    words.forEach(w=>w.classList.remove('colored'));
    let i=0;
    const interval=setInterval(()=>{
      if(i>=words.length){clearInterval(interval);return;}
      words[i].classList.add('colored');i++;
    },150);
  });
}

async function startPractice(){
  if(state.playing)return;
  state.playing=true;
  startBtn.textContent='Pause ||';
  state.repeat=Math.min(10,Math.max(1,parseInt(repeatInput.value)||1));
  while(state.playing){
    for(let r=0;r<state.repeat && state.playing;r++){
      await playOnceWithPause(state.chunks[state.chunkIndex]);
    }
    if(!state.playing)break;
    state.chunkIndex++;
    if(state.chunkIndex>=state.chunks.length){
      state.chunkIndex=0;
      highlightClear();
    }
  }
}
function pausePractice(){
  state.playing=false;
  responsiveVoice.cancel();
  startBtn.textContent='▶ Start';
}

selectQ.addEventListener('change',e=>{renderPassage(+e.target.value);});
repeatInput.addEventListener('change',()=>{
  let v=parseInt(repeatInput.value)||1;
  if(v<1)v=1;if(v>10)v=10;
  repeatInput.value=v;
});
startBtn.addEventListener('click',()=>{state.playing?pausePractice():startPractice();});
prevBtn.addEventListener('click',()=>{let i=state.random?rand():((state.idx-1+passages.length)%passages.length);selectQ.value=i;renderPassage(i);pausePractice();});
nextBtn.addEventListener('click',()=>{let i=state.random?rand():((state.idx+1)%passages.length);selectQ.value=i;renderPassage(i);pausePractice();});
modeBtn.addEventListener('click',()=>{
  state.random=!state.random;
  modeBtn.textContent=state.random?'Random Mode':'Custom Mode';
  selectQ.disabled=state.random;
  if(state.random){const i=rand();selectQ.value=i;renderPassage(i);}
});
fullscreenBtn.addEventListener('click',()=>{
  if(!document.fullscreenElement)document.documentElement.requestFullscreen();
  else document.exitFullscreen();
});
document.addEventListener('fullscreenchange',()=>fullscreenBtn.textContent=document.fullscreenElement?'Exit Full Screen':'Enter Full Screen');
function rand(){return Math.floor(Math.random()*passages.length);}
passages.forEach((p,i)=>{
  const opt=document.createElement('option');
  opt.value=i;opt.textContent=`#${p.id} ${p.title}`;
  selectQ.appendChild(opt);
});
renderPassage(0);
</script>
</body>
</html>
